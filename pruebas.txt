<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captura de Miniaturas</title>
    <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clappr-thumbnails-plugin@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Estilo para los reproductores */
        #players {
            display: flex;
            justify-content: space-between;
        }
        .player-container {
            width: 45%;
        }
        /* Estilo para las miniaturas */
        #thumbnails {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .thumbnail {
            height: 100px; /* Altura fija */
            margin-right: 5px;
            margin-bottom: 5px;
            overflow: hidden;
            border: 1px solid #ccc; /* Agregar un borde para ver mejor las miniaturas */
            display: flex; 
            justify-content: center;
            align-items: center; 
        }
    </style>
</head>
<body>
    <div id="players">
        <div class="player-container">
            <h2>Pruebas</h2>
            <video id="html5player" width="100%" muted crossOrigin="anonymous">
                <source src="https://ak2.rmbl.ws/s8/2/i/1/J/o/i1Joo.caa.mp4?u=0&b=0" type="video/mp4">
                Tu navegador no soporta el video HTML5.
            </video>
            <div id="thumbnails"></div>
        </div>

        
        <div class="player-container">
            <h2>Capturas</h2>
            <div id="clappr-player"></div>
        </div>
    </div>

    <script>
        var activeUrl = "https://ak2.rmbl.ws/s8/2/i/1/J/o/i1Joo.caa.mp4?u=0&b=0";
        var poster = "https://i.imgur.com/ymjjVCQ.png";

        // Configurar el reproductor HTML5
        var html5Player = document.getElementById('html5player');
        html5Player.volume = 0; // Silenciar el video

        // Configurar el reproductor Clappr
        var clapprPlayer = new Clappr.Player({
            source: activeUrl,
            autoPlay: true,
            width: "100%",
            poster: poster,
            parentId: "#clappr-player",
            plugins: [ClapprThumbnailsPlugin],
            scrubThumbnails: {
                backdropHeight: 64,
                spotlightHeight: 160,
                thumbs: [] // Inicialmente vacío
            }
        });

        // Función para capturar la imagen del reproductor
        function captureThumbnail() {
            html2canvas(html5Player, { useCORS: true }).then(canvas => {
                const thumbnailUrl = canvas.toDataURL();
                const currentTime = html5Player.currentTime;

                

                // Agregar miniatura al reproductor Clappr
                const newThumb = {
                    url: thumbnailUrl,
                    time: currentTime
                };

                const thumbnailsPlugin = clapprPlayer.getPlugin("scrub-thumbnails");
                thumbnailsPlugin.addThumbnail(newThumb).then(function() {
                    console.log("Miniatura añadida a Clappr:", currentTime);
                });
            }).catch(err => {
                console.error("Error al capturar la imagen: ", err);
            });
        }

        // Iniciar captura de miniaturas cada 30 segundos
        let captureInterval;
        let currentTime = 0;

        function startCapturing() {
            currentTime = 0; // Reiniciar tiempo
            document.getElementById('thumbnails').innerHTML = ''; // Limpiar contenedor de miniaturas

            captureInterval = setInterval(() => {
                if (currentTime < html5Player.duration) { // Si no hemos llegado al final del video
                    html5Player.currentTime = currentTime; // Adelantar el video al tiempo deseado
                    captureThumbnail(); // Capturar la miniatura
                    currentTime += 120; // Incrementar el tiempo en 30 segundos
                } else {
                    clearInterval(captureInterval); // Detener captura si alcanzamos el final
                    html5Player.pause(); // Pausar el video al final
                }
            }, 1000); // Esperar 1 segundo para asegurar que el video se haya cargado antes de avanzar
        }

        // Iniciar la captura cuando el video esté listo
        html5Player.addEventListener('loadedmetadata', startCapturing);
    </script>
</body>
</html>
